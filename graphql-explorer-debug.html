<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SharpGraph - Debug Schema</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>SharpGraph Schema Debug</h1>
    <button onclick="checkSchema()">Check Schema</button>
    <div id="output"></div>

    <script>
        async function checkSchema() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Fetching schema...</p>';
            
            try {
                // Test 1: Check if server is reachable
                const response1 = await fetch('http://127.0.0.1:8080/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: '{ __typename }'
                    })
                });
                const data1 = await response1.json();
                output.innerHTML += `<p class="success">✓ Server reachable</p>`;
                
                // Test 2: Get Query type with fields
                const response2 = await fetch('http://127.0.0.1:8080/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: `{
                            __type(name: "Query") {
                                fields {
                                    name
                                    args {
                                        name
                                        type { name kind }
                                    }
                                }
                            }
                        }`
                    })
                });
                const data2 = await response2.json();
                const charactersField = data2.data.__type.fields.find(f => f.name === 'characters');
                
                if (charactersField) {
                    output.innerHTML += `<p class="success">✓ characters field found</p>`;
                    output.innerHTML += `<p>Arguments:</p><pre>${JSON.stringify(charactersField.args, null, 2)}</pre>`;
                    
                    const whereArg = charactersField.args.find(a => a.name === 'where');
                    if (whereArg) {
                        output.innerHTML += `<p class="success">✓ where argument exists: ${whereArg.type.name}</p>`;
                    } else {
                        output.innerHTML += `<p class="error">✗ where argument NOT FOUND</p>`;
                    }
                } else {
                    output.innerHTML += `<p class="error">✗ characters field NOT FOUND</p>`;
                }
                
                // Test 3: Try the actual query
                const response3 = await fetch('http://127.0.0.1:8080/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: `{
                            characters(where: { name: { contains: "Skywalker" } }) {
                                id
                                name
                            }
                        }`
                    })
                });
                const data3 = await response3.json();
                
                if (data3.errors) {
                    output.innerHTML += `<p class="error">✗ Query failed:</p><pre>${JSON.stringify(data3.errors, null, 2)}</pre>`;
                } else {
                    output.innerHTML += `<p class="success">✓ Query executed successfully</p>`;
                    output.innerHTML += `<pre>${JSON.stringify(data3, null, 2)}</pre>`;
                }
                
            } catch (error) {
                output.innerHTML += `<p class="error">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
