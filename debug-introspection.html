<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Debug GraphQL Validation</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .section { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; border-radius: 3px; font-size: 11px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Debug: What does the server return?</h1>
    
    <div class="section">
        <h3>Raw Query via Simple HTTP POST</h3>
        <button onclick="runTest()">Fetch Schema</button>
        <pre id="output"></pre>
    </div>

    <script>
        async function runTest() {
            const output = document.getElementById('output');
            output.textContent = 'Fetching...';
            
            try {
                const response = await fetch('http://127.0.0.1:8080/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: `{
                            __schema {
                                types {
                                    name
                                    kind
                                }
                                queryType { name }
                            }
                        }`
                    })
                });
                
                const data = await response.json();
                
                // Check if Query type exists
                const queryType = data.data.__schema.types.find(t => t.name === 'Query');
                
                output.textContent = `Query type found: ${queryType ? 'YES' : 'NO'}\n\n`;
                output.textContent += `Total types: ${data.data.__schema.types.length}\n\n`;
                output.textContent += `Types in schema:\n`;
                
                data.data.__schema.types.forEach(t => {
                    output.textContent += `  - ${t.name} (${t.kind})\n`;
                });
                
                // Now get the full Query type
                output.textContent += '\n\n=== FULL QUERY TYPE ===\n';
                const fullQueryResponse = await fetch('http://127.0.0.1:8080/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: `{
                            __type(name: "Query") {
                                name
                                kind
                                description
                                fields {
                                    name
                                    description
                                    args {
                                        name
                                        description
                                        type {
                                            kind
                                            name
                                            ofType {
                                                kind
                                                name
                                                ofType {
                                                    kind
                                                    name
                                                }
                                            }
                                        }
                                        defaultValue
                                    }
                                    type {
                                        kind
                                        name
                                        ofType {
                                            kind
                                            name
                                        }
                                    }
                                    isDeprecated
                                    deprecationReason
                                }
                                interfaces {
                                    name
                                    kind
                                }
                                possibleTypes {
                                    name
                                    kind
                                }
                            }
                        }`
                    })
                });
                
                const fullData = await fullQueryResponse.json();
                output.textContent += JSON.stringify(fullData, null, 2);
                
            } catch (error) {
                output.textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
