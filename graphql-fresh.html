<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>GraphiQL - Fresh Schema</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
            width: 100%;
        }
    </style>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/graphiql@2/graphiql.min.css"/>
</head>
<body>
    <div id="graphiql">Loading...</div>
    <script src="https://unpkg.com/graphiql@2/graphiql.min.js"></script>
    <script src="https://unpkg.com/@graphiql/plugin-explorer@0.1.0/dist/graphiql-explorer.umd.js"></script>
    <script>
        // Force complete cache clear on every load
        if (typeof indexedDB !== 'undefined') {
            const dbs = ['graphiql', 'graphiql-schema'];
            dbs.forEach(db => {
                const req = indexedDB.deleteDatabase(db);
                req.onsuccess = () => console.log(`Deleted IndexedDB: ${db}`);
                req.onerror = () => console.log(`Failed to delete IndexedDB: ${db}`);
            });
        }
        
        // Clear localStorage
        const keys = Object.keys(localStorage);
        keys.forEach(key => {
            if (key.toLowerCase().includes('graphql') || key.toLowerCase().includes('schema')) {
                localStorage.removeItem(key);
                console.log(`Cleared localStorage: ${key}`);
            }
        });
        
        // Clear sessionStorage
        const sessionKeys = Object.keys(sessionStorage);
        sessionKeys.forEach(key => {
            if (key.toLowerCase().includes('graphql') || key.toLowerCase().includes('schema')) {
                sessionStorage.removeItem(key);
                console.log(`Cleared sessionStorage: ${key}`);
            }
        });
        
        const fetcher = GraphiQL.createFetcher({
            url: 'http://127.0.0.1:8080/graphql',
        });

        function GraphiQLComponent() {
            const [query, setQuery] = React.useState(`{
  characters(where: { name: { contains: "Luke" } }) {
    id
    name
  }
}`);
            
            return React.createElement(GraphiQL, {
                fetcher,
                query,
                onEditQuery: setQuery,
                defaultQuery: `{
  characters(where: { name: { contains: "Luke" } }) {
    id
    name
  }
}`,
            });
        }

        ReactDOM.render(
            React.createElement(GraphiQLComponent),
            document.getElementById('graphiql'),
        );
    </script>
</body>
</html>
